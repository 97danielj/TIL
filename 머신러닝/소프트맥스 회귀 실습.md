[toc]

# 10) 소프트맥스 회귀 실습

소프트맥스 회귀는 다중 클래스를 위해 사용되는 활성화 함수이다. k차원의 벡터에서 i번째 원소를 $z_i$, i번째 클래스가 정답일 확률을 $p_i$로 나타낸다고 하였을 때 소프트맥스 함수는 $p_i$를 다음과 같이 정의합니다. k번일 확률 / 전체확률
$$
p_{i}=\frac{e^{z_{i}}}{\sum_{j=1}^{k} e^{z_{j}}}\ \ for\ i=1, 2, ... k
$$
$p_1,p_2,p_3$ 각각은 1번 클래스가 정답일 확률, 2번 클래스가 정답일 확률, 3번 클래스가 정답일 확률을 나타내며 각각 0과 1사이의 값으로 총 합은 1이 됩니다.

![img](https://wikidocs.net/images/page/35476/softmax5_final.PNG)

# 1. 아이리스 품종 데이터에 대한 이해

데이터는 6개의 열로 구성된 총 150개의 샘플로 구성되어져 있습니다. 각 샘플의 인덱스를 의미하는 첫번째 열인 Id는 실질적으로 의미는 없는 열입니다. 그 후 특성(feature)에 해당하는 SepalLengthCm, SepalWidthCm, PetalLengthCm, PetalWidthCm 4개의 열이 존재합니다. 마지막 열 Species는 해당 샘플이 어떤 품종인지를 의미하며 여기서 예측해야 하는 레이블에 해당됩니다. Species열에서 품종이 몇 개 존재하는지 출력합니다.

```python
data['Species'].unique()
```

Species는 Iris-setosa, Iris-versicolor, Iris-virginica라는 3개의 품종으로 구성되어져 있습니다. 즉, 이번 데이터를 가지고 푸는 문제는 주어진 샘플 데이터의 4개의 특성으로부터 3개 중 어떤 품종인지를 예측하는 문제가 되겠습니다. 3개의 품종이 4개의 특성에 대해서 어떤 분포를 가지고 있는지 시각화해봅시다. seaborn의 pairplot은 데이터프레임을 입력으로 받아 데이터프레임의 각 열의 조합에 따라서 산점도(scatter plot)를 그립니다.

```python
#데이터프레임에서 각 열의 산점도 알아보기
sns.set(style="ticks", color_codes = True)
g = sns.pairplot(data,hue='Species',palette='husl')
```

```python
#각 종과 특성에 대한 연관관계
sns.barplot(data['Species'], data['SepalWidthCm'], ci=None)

#샘플에 각 품종이 몇 개있는지 확인합니다.
data['Species'].value_counts().plot(kind='bar')
```

동일하게 50개씩 존재합니다. 각 레이블에 대한 분포가 균일합니다. 소프트맥스 회귀 모델을 구성하기 위해 전처리를 진행해야 합니다. 레이블에 해당하는 Species열에 대해서 전부 수치화를 진행해봅시다. 우선 **원-핫 인코딩을 수행하기 전 정수 인코딩**을 수행합니다. 정상적으로 정수 인코딩이 수행되었는지 확인하기 위하여 다시 한 번 값의 분포를 출력합니다.

```python
# Iris-virginica는 0, Iris-setosa는 1, Iris-versicolor는 2가 됨.
data['Species'] = data['Species'].replace(['Iris-virginica','Iris-setosa','Iris-versicolor'],[0,1,2])
data['Species'].value_counts().plot(kind='bar')
```

![img](https://wikidocs.net/images/page/35476/%EA%B0%92%EC%9D%98%EB%B6%84%ED%8F%AC2.png)

여여전히 동일한 분포를 보입니다. 특성과 품종을 각각 종속 변수와 독립 변수 데이터로 분리하는 작업을 수행하고, 정확하게 분리가 되었는지 확인하기 위해 데이터 중 상위 5개씩 출력해보겠습니다.

``` python
data_X = data[['SepalLengthCm', 'SepalWidthCm', 'PetalLengthCm', 'PetalWidthCm']].values
#레이블 데이터
data_y = data['Species'].values

# 훈련데이터와 테스트데이터 분리
X_train, X_test, y_train, y_test = train_test_split(data_X, data_y,train_size=0.8,random_state=1)
# 원-핫 인코딩
y_train = to_categorical(y_train)
y_test = to_categorical(y_test)

```

## 2. 소프트맥스 회귀

입력의 차원이 4차원이므로  input_dim의 인자값이 4로 변경되었습니다. 출력의 차원이 3이므로 input_dim매개변수 앞의 인자값이 3입니다. 또한 활성화 함수로는 소프트맥스 함수를 사용하므로 activation = 'softmax'를 사용합니다.